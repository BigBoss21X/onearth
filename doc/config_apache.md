# Apache Configuration

The following sections outline the configuration updates that are required in order to serve imagery through the OnEarth apache module.  Configuration changes may be made directly in the `/etc/httpd/conf/conf.d` file or in a `/etc/httpd/conf.d/<config.d>` file.  The latter requires that Apache be configured to read configuration files in the `conf.d` directory.

## OnEarth Modules
The OnEarth utility installs two Apache modules into the apache `<lib dir>/httpd/modules/` directory.  Apache must be configured to include these modules.  To do so, the following lines must be added to the apache configuration file.

```bash
LoadModule wms_module modules/mod_wms.so
LoadModule twms_module modules/mod_twms.so
```

## OnEarth Endpoint Directories
A <Directory> element must be included in the Apache configuration for each OnEarth imagery service endpoint.  A sample configuration element is shown below.  Note the following items of interest:

* **OptionsIndexes** - The _FollowSymLinks_ option allows for an endpoint to be configured using symlinks for simpler configuration management.  The _ExecCGI_ option is required to execute the WMTS and TWMS CGI script.
* **WMSCache** - This custom element points to the WMTS or TWMS cache configuration file that is generated by the OnEarth layer configuration tool.
* **Rewrite** - The suggested configuration rewrites '.jpg' to '.jpeg' to optimize URL matching internal to the OnEarth module.

```bash
<Directory "/srv/www/onearth/wmts/geographic">
    OptionsIndexes FollowSymLinks+ExecCGI
    AddHandler cgi-script .cgi
    AllowOverrideNone
    Order allow,deny
    Allow from all
    WMSCache        /archive/imagery/cache_wmts.config

    Header set Access-Control-Allow-Origin *

    RewriteEngineOn
    RewriteBase /wmts/geographic/

    # rewrite .jpg -> .jpeg
    RewriteRule ^(.+)\.jpg$ $1.jpeg

</Directory>
```
